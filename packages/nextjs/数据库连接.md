

数据库连接与自动建表已经完成

铸造流程写库

在文件：packages\nextjs\app\myNFTs\_components\CustomNFTMinter.tsx 添加代码

添加在102行之后就可以

```
铸造流程写库
在文件：packages\nextjs\app\myNFTs\_components\CustomNFTMinter.tsx 添加代码
添加在102行之后就可以
    // Save image url to DB
      try {
        await fetch("/api/db/save-image", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            walletAddress: connectedAddress,
            metadataHash: metadataResult.metadataHash,
            imageUrl: uploadedImageUrl,
          }),
        });
      } catch (e) {
        console.error("Save image to DB failed", e);
      }

```





预置铸造：在上传预置元数据到 IPFS 后，立即写入数据库

在文件：packages\nextjs\app\myNFTs\page.tsx 添加代码

添加在38行之后就可以

```
    try {

​    await fetch("/api/db/save-image", {

​     method: "POST",

​     headers: { "Content-Type": "application/json" },

​     body: JSON.stringify({

​      walletAddress: connectedAddress,

​      metadataHash: uploadedItem.path,

​      imageUrl: currentTokenMetaData.image,

​     }),

​    });

   } catch (e) {

​    console.error("Save preset image to DB failed", e);

   }
```



空投：在生成元数据后，立即写入数据库
在文件：packages\nextjs\app\myNFTs\_components\AirdropMinter.tsx 添加代码
添加在68行之后就可以

```

      try {
        await fetch("/api/db/save-image", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            walletAddress: connectedAddress,
            metadataHash: metaJson.metadataHash,
            imageUrl: imgJson.imageUrl,
          }),
        });
      } catch (e) {
        console.error("Save airdrop image to DB failed", e);
      }

```



批量铸造（预置）：每个循环上传元数据后写库
在文件：packages\nextjs\app\myNFTs\_components\BatchNFTMinter.tsx 添加代码
添加在34行之后就可以

```

         try {
          await fetch("/api/db/save-image", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              walletAddress: connectedAddress,
              metadataHash: uploadedItem.path,
              imageUrl: currentTokenMetaData.image,
            }),
          });
        } catch (e) {
          console.error("Save batch image to DB failed", e);
        }

```



Excel 批量铸造：对每个上传结果写库后再铸造

在文件：packages\nextjs\app\myNFTs\_components\ExcelBatchMinter.tsx 添加代码

添加在108行之后就可以





```
            try {
          await fetch("/api/db/save-image", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              walletAddress: connectedAddress,
              metadataHash: nftResult.metadataHash,
              imageUrl: nftResult.imageUrl,
            }),
          });
        } catch (e) {
          console.error("Save excel batch image to DB failed", e);
        }

```



展示图片走数据库（我的持仓）

在文件：packages\nextjs\app\myNFTs\_components\MyHoldings.tsx 添加代码

添加在73行之后就可以

```
      try {

​      const dbRes = await fetch(`/api/db/get-image?hash=${ipfsHash}`);

​      if (dbRes.ok) {

​       const dbJson = await dbRes.json();

​       if (dbJson?.found && dbJson?.imageUrl) {

​        nftMetadata.image = dbJson.imageUrl;

​       }

​      }

​     } catch (e) {

​      // ignore DB errors, fallback to IPFS metadata image

​     }
```



在文件：packages\nextjs\.env.local 添加代码

添加在最后面就可以 （注意：数据库配置一定要配置自己的特别是密码）

​    



\# MySQL 数据库配置（用于保存 NFT 图片链接）

DB_HOST=localhost

DB_PORT=3306

DB_USER=root

DB_PASSWORD=123456

DB_DATABASE=nft

数据库已经连接配置
